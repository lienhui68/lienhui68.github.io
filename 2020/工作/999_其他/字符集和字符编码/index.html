<!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1"><meta name="format-detection" content="telephone=no"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="black"><link rel="icon" href="/assets/1.png?v=2.0.1" type="image/png" sizes="16x16"><link rel="icon" href="/assets/1.png?v=2.0.1" type="image/png" sizes="32x32"><meta name="description" content="相信大家一定碰到过，打开某个网页，却显示一堆像乱码，如&quot;бЇЯАзЪСЯ&quot;、“�???”？还记得HTTP中的Accept-Charset、Accept-Encoding、Accept-Language、Content-Encoding、Content-Language等消息头字段？这些就是接下来我们要探讨的。">
<meta property="og:type" content="article">
<meta property="og:title" content="字符集和字符编码（Charset &amp; Encoding）">
<meta property="og:url" content="http://lienhui68.gitee.io/2020/%E5%B7%A5%E4%BD%9C/999_%E5%85%B6%E4%BB%96/%E5%AD%97%E7%AC%A6%E9%9B%86%E5%92%8C%E5%AD%97%E7%AC%A6%E7%BC%96%E7%A0%81/index.html">
<meta property="og:site_name" content="lienhui68の博客">
<meta property="og:description" content="相信大家一定碰到过，打开某个网页，却显示一堆像乱码，如&quot;бЇЯАзЪСЯ&quot;、“�???”？还记得HTTP中的Accept-Charset、Accept-Encoding、Accept-Language、Content-Encoding、Content-Language等消息头字段？这些就是接下来我们要探讨的。">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://gitee.com/lienhui68/picStore/raw/master/null/2011050311372042.png">
<meta property="og:image" content="https://gitee.com/lienhui68/picStore/raw/master/null/201105031137219627.png">
<meta property="og:image" content="https://gitee.com/lienhui68/picStore/raw/master/null/201105031137227086.png">
<meta property="og:image" content="https://gitee.com/lienhui68/picStore/raw/master/null/201105031137222069.jpg">
<meta property="og:image" content="https://gitee.com/lienhui68/picStore/raw/master/null/emoji_ios-20200928195924222-20200928195932383.png">
<meta property="og:image" content="https://gitee.com/lienhui68/picStore/raw/master/null/emoji_ios2-20200928195932782-20200928200001353.png">
<meta property="og:image" content="https://gitee.com/lienhui68/picStore/raw/master/null/emoji_ios3-20200928200001603.png">
<meta property="og:image" content="https://gitee.com/lienhui68/picStore/raw/master/null/image-20200928202226010.png">
<meta property="article:published_time" content="2020-09-28T10:46:21.675Z">
<meta property="article:modified_time" content="2020-09-28T12:28:49.265Z">
<meta property="article:author" content="lienhui68">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://gitee.com/lienhui68/picStore/raw/master/null/2011050311372042.png"><meta name="keywords" content="lienhui68, lienhui68の博客"><meta name="description" content=""><title>字符集和字符编码（Charset &amp; Encoding） | lienhui68の博客</title><link ref="canonical" href="http://lienhui68.gitee.io/2020/%E5%B7%A5%E4%BD%9C/999_%E5%85%B6%E4%BB%96/%E5%AD%97%E7%AC%A6%E9%9B%86%E5%92%8C%E5%AD%97%E7%AC%A6%E7%BC%96%E7%A0%81/"><link rel="dns-prefetch" href="https://cdn.jsdelivr.net"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.12.1/css/all.min.css" type="text/css"><link rel="stylesheet" href="/css/index.css?v=2.0.1"><script>var Stun = window.Stun || {};
var CONFIG = {
  root: '/',
  algolia: undefined,
  fontIcon: {"prompt":{"success":"fas fa-check-circle","info":"fas fa-arrow-circle-right","warning":"fas fa-exclamation-circle","error":"fas fa-times-circle"},"copyBtn":"fas fa-copy"},
  sidebar: {"offsetTop":"20px","tocMaxDepth":6},
  header: undefined,
  postWidget: {"endText":true},
  nightMode: {"enable":true},
  back2top: {"enable":true},
  codeblock: {"style":"carbon","highlight":"ocean","wordWrap":false},
  reward: true,
  fancybox: false,
  zoomImage: {"gapAside":"20px"},
  galleryWaterfall: {"colWidth":"220px","gapX":"10px"},
  lazyload: true,
  pjax: undefined,
  externalLink: {"icon":{"enable":true,"name":"fas fa-external-link-alt"}},
  shortcuts: undefined,
  prompt: {"copyButton":"复制","copySuccess":"复制成功","copyError":"复制失败"},
  sourcePath: {"js":"js","css":"css","images":"images"},
};

window.CONFIG = CONFIG;</script><meta name="generator" content="Hexo 4.2.1"></head><body><div class="container" id="container"><header class="header" id="header"><div class="header-inner header-inner--height header-inner--bgcolor"><nav class="header-nav header-nav--sticky"><div class="header-nav-inner"><div class="header-nav-menubtn"><i class="fas fa-bars"></i></div><div class="header-nav-menu"><div class="header-nav-menu-item"><a class="header-nav-menu-item__link" href="/"><span class="header-nav-menu-item__icon"><i class="fas fa-home"></i></span><span class="header-nav-menu-item__text">首页</span></a></div><div class="header-nav-menu-item"><a class="header-nav-menu-item__link" href="/archives/"><span class="header-nav-menu-item__icon"><i class="fas fa-folder-open"></i></span><span class="header-nav-menu-item__text">归档</span></a></div><div class="header-nav-menu-item"><a class="header-nav-menu-item__link" href="/categories/"><span class="header-nav-menu-item__icon"><i class="fas fa-layer-group"></i></span><span class="header-nav-menu-item__text">分类</span></a></div><div class="header-nav-menu-item"><a class="header-nav-menu-item__link" href="/tags/"><span class="header-nav-menu-item__icon"><i class="fas fa-tags"></i></span><span class="header-nav-menu-item__text">标签</span></a></div><div class="header-nav-menu-item"><a class="header-nav-menu-item__link" href="javascript:;" onclick="return false;"><span class="header-nav-menu-item__icon"><i class="fas fa-flask"></i></span><span class="header-nav-menu-item__text">实验室</span></a><div class="header-nav-submenu"><div class="header-nav-submenu-item"><a class="header-nav-submenu-item__link" href="/photo/"><span class="header-nav-submenu-item__icon"><i class="fas fa-images"></i></span><span class="header-nav-submenu-item__text">相册</span></a></div><div class="header-nav-submenu-item"><a class="header-nav-submenu-item__link" href="/music/"><span class="header-nav-submenu-item__icon"><i class="fas fa-music"></i></span><span class="header-nav-submenu-item__text">音乐</span></a></div></div></div><div class="header-nav-menu-item"><a class="header-nav-menu-item__link" href="/about/"><span class="header-nav-menu-item__icon"><i class="fas fa-user"></i></span><span class="header-nav-menu-item__text">关于</span></a></div></div><div class="header-nav-search"><span class="header-nav-search__icon"><i class="fas fa-search"></i></span><span class="header-nav-search__text">搜索</span></div><div class="header-nav-mode"><div class="mode"><div class="mode-track"><span class="mode-track-moon"></span><span class="mode-track-sun"></span></div><div class="mode-thumb"></div></div></div></div></nav></div></header><main class="main" id="main"><div class="main-inner"><div class="content-wrap" id="content-wrap"><div class="content" id="content"><!-- Just used to judge whether it is an article page--><div id="is-post"></div><div class="post"><header class="post-header"><h1 class="post-title">字符集和字符编码（Charset &amp; Encoding）</h1><div class="post-meta"><span class="post-meta-item post-meta-item--createtime"><span class="post-meta-item__icon"><i class="far fa-calendar-plus"></i></span><span class="post-meta-item__info">发表于</span><span class="post-meta-item__value">2020-09-28</span></span><span class="post-meta-item post-meta-item--updatetime"><span class="post-meta-item__icon"><i class="far fa-calendar-check"></i></span><span class="post-meta-item__info">更新于</span><span class="post-meta-item__value">2020-09-28</span></span><span class="post-meta-item post-meta-item--wordcount"><span class="post-meta-item__icon"><i class="far fa-file-word"></i></span><span class="post-meta-item__info">字数统计</span><span class="post-meta-item__value">8.1k</span></span><span class="post-meta-item post-meta-item--readtime"><span class="post-meta-item__icon"><i class="far fa-clock"></i></span><span class="post-meta-item__info">阅读时长</span><span class="post-meta-item__value">47分</span></span><span class="post-meta-item post-meta-item--visitors"><span class="post-meta-item__icon"><i class="fas fa-eye"></i></span><span class="post-meta-item__info">阅读次数</span><span class="post-meta-item__value" id="busuanzi_value_page_pv"></span></span></div></header><div class="post-body"><p>相信大家一定碰到过，打开某个网页，却显示一堆像乱码，如&quot;бЇЯАзЪСЯ&quot;、“�???”？还记得HTTP中的Accept-Charset、Accept-Encoding、Accept-Language、Content-Encoding、Content-Language等消息头字段？这些就是接下来我们要探讨的。</p>
<a id="more"></a>

        <h1 id="基础知识"   >
          <a href="#基础知识" class="heading-link"><i class="fas fa-link"></i></a>基础知识</h1>
      
<p>计算机中储存的信息都是用二进制数表示的；而我们在屏幕上看到的英文、汉字等字符是二进制数转换之后的结果。通俗的说，<span style='color:LimeGreen;background:背景颜色;font-size:文字大小;font-weight:'>按照何种规则将字符存储在计算机中，如’a’用什么表示，称为&quot;编码&quot;；反之，将存储在计算机中的二进制数解析显示出来，称为&quot;解码&quot;</span>，如同密码学中的加密和解密。在解码过程中，如果使用了错误的解码规则，则导致’a’解析成’b’或者乱码。</p>
<p><strong>字符集（Charset）</strong>：<span style='color:red;background:背景颜色;font-size:文字大小;font-weight:'>是一个系统支持的所有抽象字符的集合</span>。字符是各种文字和符号的总称，包括各国家文字、标点符号、图形符号、数字等。</p>
<p><strong>字符编码（Character Encoding）</strong>：是一套法则，使用该法则能够对自然语言的字符的一个集合（如字母表或音节表），与其他东西的一个集合（如号码或电脉冲）进行配对。即在符号集合与数字系统之间建立对应关系，它是信息处理的一项基本技术。通常人们用符号集合（一般情况下就是文字）来表达信息。而以计算机为基础的信息处理系统则是利用元件（硬件）不同状态的组合来存储和处理信息的。元件不同状态的组合能代表数字系统的数字，因此字符编码就是<span style='color:red;background:背景颜色;font-size:文字大小;font-weight:'>将符号转换为计算机可以接受的数字系统的数</span>，称为<strong>数字代码</strong>。</p>
<p>我们来看一个实际例子，下面就是<code>屌</code>这个字在各种编码下的十六进制和二进制编码结果，怎么样有没有一种很屌的感觉？</p>
<div class="table-container"><table>
<thead>
<tr>
<th style="text-align:left">字符编码</th>
<th style="text-align:left">16进制编码</th>
<th style="text-align:left">对应的二进制数据</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">UTF-8</td>
<td style="text-align:left">0xE5B18C</td>
<td style="text-align:left">1110 0101 1011 0001 1000 1100</td>
</tr>
<tr>
<td style="text-align:left">UTF-16</td>
<td style="text-align:left">0x5C4C</td>
<td style="text-align:left">1011 1000 1001 1000</td>
</tr>
<tr>
<td style="text-align:left">GBK</td>
<td style="text-align:left">0x8CC5</td>
<td style="text-align:left">1000 1100 1100 0101</td>
</tr>
</tbody>
</table></div>

        <h1 id="常用字符集和字符编码"   >
          <a href="#常用字符集和字符编码" class="heading-link"><i class="fas fa-link"></i></a>常用字符集和字符编码</h1>
      
<p>常见字符集名称：ASCII字符集、GB2312字符集、BIG5字符集、GB18030字符集、Unicode字符集等。计算机要准确的处理各种字符集文字，需要进行字符编码，以便计算机能够识别和存储各种文字。</p>

        <h2 id="ascii字符集编码"   >
          <a href="#ascii字符集编码" class="heading-link"><i class="fas fa-link"></i></a>ASCII字符集&amp;编码</h2>
      
<p><strong>ASCII</strong>（<strong>A</strong>merican <strong>S</strong>tandard <strong>C</strong>ode for <strong>I</strong>nformation <strong>I</strong>nterchange，<strong>美国信息交换标准代码</strong>）是基于<span class="exturl"><a class="exturl__link"   href="http://zh.wikipedia.org/wiki/%E6%8B%89%E4%B8%81%E5%AD%97%E6%AF%8D"  target="_blank" rel="noopener">拉丁字母</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span>的一套<span class="exturl"><a class="exturl__link"   href="http://zh.wikipedia.org/wiki/%E7%94%B5%E8%84%91"  target="_blank" rel="noopener">电脑</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span><span class="exturl"><a class="exturl__link"   href="http://zh.wikipedia.org/wiki/%E7%BC%96%E7%A0%81"  target="_blank" rel="noopener">编码</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span>系统。它主要用于显示<span class="exturl"><a class="exturl__link"   href="http://zh.wikipedia.org/wiki/%E7%8F%BE%E4%BB%A3%E8%8B%B1%E8%AA%9E"  target="_blank" rel="noopener">现代英语</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span>，而其扩展版本EASCII则可以勉强显示其他<span class="exturl"><a class="exturl__link"   href="http://zh.wikipedia.org/wiki/%E8%A5%BF%E6%AC%A7"  target="_blank" rel="noopener">西欧</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span><span class="exturl"><a class="exturl__link"   href="http://zh.wikipedia.org/wiki/%E8%AF%AD%E8%A8%80"  target="_blank" rel="noopener">语言</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span>。它是现今最通用的单<span class="exturl"><a class="exturl__link"   href="http://zh.wikipedia.org/wiki/%E5%AD%97%E8%8A%82"  target="_blank" rel="noopener">字节</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span>编码系统（但是有被Unicode追上的迹象），并等同于国际标准<strong>ISO/IEC 646</strong>。</p>
<p><strong>ASCII字符集</strong>：主要包括控制字符（回车键、退格、换行键等）；可显示字符（英文大小写字符、阿拉伯数字和西文符号）。</p>
<p><strong>ASCII编码</strong>：将ASCII字符集转换为计算机可以接受的数字系统的数的规则。使用7位（bits）表示一个字符，共128字符；但是7位编码的字符集只能支持128个字符，为了表示更多的<span class="exturl"><a class="exturl__link"   href="http://baike.baidu.com/view/3622.htm"  target="_blank" rel="noopener">欧洲</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span>常用字符对ASCII进行了扩展，ASCII扩展字符集使用8位（bits）表示一个字符，共256字符。ASCII字符集映射到数字编码规则如下图所示：</p>
<p>
        <img   class="lazyload lazyload-gif"
          src="/images/loading.svg" data-src="https://gitee.com/lienhui68/picStore/raw/master/null/2011050311372042.png"  alt="img" />
      </p>
<p><span style='text-align: center;display:block;font-size:14px;color:颜色;background:背景颜色;'>图1 ASCII编码表</span></p>
<p>
        <img   class="lazyload lazyload-gif"
          src="/images/loading.svg" data-src="https://gitee.com/lienhui68/picStore/raw/master/null/201105031137219627.png"  alt="img" />
      </p>
<p><span style='text-align: center;display:block;font-size:14px;color:颜色;background:背景颜色;'>图2 扩展ASCII编码表</span></p>
<p>ASCII的最大缺点是只能显示26个基本拉丁字母、阿拉伯数目字和英式标点符号，因此只能用于显示现代美国英语（而且在处理英语当中的外来词如naïve、café、élite等等时，所有重音符号都不得不去掉，即使这样做会违反拼写规则）。而EASCII虽然解决了部份西欧语言的显示问题，但对更多其他语言依然无能为力。因此现在的苹果电脑已经抛弃ASCII而转用<span class="exturl"><a class="exturl__link"   href="http://zh.wikipedia.org/wiki/Unicode"  target="_blank" rel="noopener">Unicode</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span>。</p>

        <h2 id="gbxxxx字符集编码"   >
          <a href="#gbxxxx字符集编码" class="heading-link"><i class="fas fa-link"></i></a>GBXXXX字符集&amp;编码</h2>
      
<p>计算机发明之初及后面很长一段时间，只用应用于美国及西方一些发达国家，ASCII能够很好满足用户的需求。但是当天朝也有了计算机之后，为了显示中文，必须设计一套编码规则用于将汉字转换为计算机可以接受的数字系统的数。</p>
<p>天朝专家把那些127号之后的奇异符号们（即EASCII）取消掉，规定：一个小于127的字符的意义与原来相同，但两个大于127的字符连在一起时，就表示一个汉字，前面的一个字节（他称之为高字节）从0xA1用到 0xF7，后面一个字节（低字节）从0xA1到0xFE，这样我们就可以组合出大约7000多个简体汉字了。在这些编码里，还把数学符号、罗马希腊的 字母、日文的假名们都编进去了，连在ASCII里本来就有的数字、标点、字母都统统重新编了两个字节长的编码，这就是常说的<strong>全角字符</strong>，而原来在127号以下的那些就叫<strong>半角字符</strong>了。</p>
<p>上述编码规则就是<strong>GB2312</strong>。<strong>GB2312</strong>或<strong>GB2312-80</strong>是<span class="exturl"><a class="exturl__link"   href="http://zh.wikipedia.org/wiki/%E4%B8%AD%E5%8D%8E%E4%BA%BA%E6%B0%91%E5%85%B1%E5%92%8C%E5%9B%BD%E5%9B%BD%E5%AE%B6%E6%A0%87%E5%87%86"  target="_blank" rel="noopener">中国国家标准</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span><span class="exturl"><a class="exturl__link"   href="http://zh.wikipedia.org/wiki/%E7%AE%80%E4%BD%93%E4%B8%AD%E6%96%87"  target="_blank" rel="noopener">简体中文</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span><span class="exturl"><a class="exturl__link"   href="http://zh.wikipedia.org/wiki/%E5%AD%97%E7%AC%A6%E9%9B%86"  target="_blank" rel="noopener">字符集</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span>，全称《<strong>信息交换用汉字编码字符集·基本集</strong>》，又称<a href="http://zh.wikipedia.org/wiki/%E5%9B%BD%E5%AE%B6%E6%A0%87%E5%87%86%E4%BB%A3%E7%A0%81" target="_blank" rel="noopener"><strong>GB0</strong></a>，由<span class="exturl"><a class="exturl__link"   href="http://zh.wikipedia.org/w/index.php?title=%E4%B8%AD%E5%9B%BD%E5%9B%BD%E5%AE%B6%E6%A0%87%E5%87%86%E6%80%BB%E5%B1%80&amp;action=edit&amp;redlink=1"  target="_blank" rel="noopener">中国国家标准总局</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span>发布，<span class="exturl"><a class="exturl__link"   href="http://zh.wikipedia.org/wiki/1981%E5%B9%B4"  target="_blank" rel="noopener">1981年</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span><span class="exturl"><a class="exturl__link"   href="http://zh.wikipedia.org/wiki/5%E6%9C%881%E6%97%A5"  target="_blank" rel="noopener">5月1日</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span>实施。GB2312编码通行于中国大陆；<span class="exturl"><a class="exturl__link"   href="http://zh.wikipedia.org/wiki/%E6%96%B0%E5%8A%A0%E5%9D%A1"  target="_blank" rel="noopener">新加坡</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span>等地也采用此编码。中国大陆几乎所有的中文系统和国际化的软件都支持GB2312。GB2312的出现，基本满足了汉字的计算机处理需要，它所收录的汉字已经覆盖中国大陆99.75%的使用频率。对于<span class="exturl"><a class="exturl__link"   href="http://zh.wikipedia.org/wiki/%E4%BA%BA%E5%90%8D"  target="_blank" rel="noopener">人名</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span>、<span class="exturl"><a class="exturl__link"   href="http://zh.wikipedia.org/wiki/%E5%8F%A4%E6%B1%89%E8%AF%AD"  target="_blank" rel="noopener">古汉语</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span>等方面出现的<span class="exturl"><a class="exturl__link"   href="http://zh.wikipedia.org/wiki/%E7%BD%95%E7%94%A8%E5%AD%97"  target="_blank" rel="noopener">罕用字</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span>，GB2312不能处理，这导致了后来<span class="exturl"><a class="exturl__link"   href="http://zh.wikipedia.org/wiki/GBK"  target="_blank" rel="noopener">GBK</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span>及<span class="exturl"><a class="exturl__link"   href="http://zh.wikipedia.org/wiki/GB_18030"  target="_blank" rel="noopener">GB 18030</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span>汉字字符集的出现。下图是GB2312编码的开始部分（由于其非常庞大，只列举开始部分，具体可查看<span class="exturl"><a class="exturl__link"   href="http://www.knowsky.com/resource/gb2312tbl.htm"  target="_blank" rel="noopener">GB2312简体中文编码表</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span>）：</p>
<p>
        <img   class="lazyload lazyload-gif"
          src="/images/loading.svg" data-src="https://gitee.com/lienhui68/picStore/raw/master/null/201105031137227086.png"  alt="img" />
      </p>
<p><span style='text-align: center;display:block;font-size:14px;color:颜色;background:背景颜色;'>图3 GB2312编码表的开始部分</span></p>
<p>由于<span class="exturl"><a class="exturl__link"   href="http://zh.wikipedia.org/wiki/GB_2312"  target="_blank" rel="noopener">GB 2312-80</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span>只收录6763个汉字，有不少汉字，如部分在GB 2312-80推出以后才简化的汉字（如&quot;啰&quot;），部分人名用字（如中国前总理<span class="exturl"><a class="exturl__link"   href="http://zh.wikipedia.org/wiki/%E6%9C%B1%E9%95%95%E5%9F%BA"  target="_blank" rel="noopener">朱镕基</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span>的&quot;镕&quot;字），台湾及香港使用的<span class="exturl"><a class="exturl__link"   href="http://zh.wikipedia.org/wiki/%E7%B9%81%E4%BD%93%E4%B8%AD%E6%96%87"  target="_blank" rel="noopener">繁体字</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span>，<span class="exturl"><a class="exturl__link"   href="http://zh.wikipedia.org/wiki/%E6%97%A5%E8%AF%AD"  target="_blank" rel="noopener">日语</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span>及<span class="exturl"><a class="exturl__link"   href="http://zh.wikipedia.org/wiki/%E9%9F%93%E8%AA%9E"  target="_blank" rel="noopener">朝鲜语</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span>汉字等，并未有收录在内。于是厂商微软利用GB 2312-80未使用的编码空间，收录GB 13000.1-93全部字符制定了GBK编码。根据<span class="exturl"><a class="exturl__link"   href="http://zh.wikipedia.org/wiki/%E5%BE%AE%E8%BD%AF"  target="_blank" rel="noopener">微软</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span>资料，GBK是对GB2312-80的扩展，也就是<a href="http://zh.wikipedia.org/w/index.php?title=CP936&amp;action=edit&amp;redlink=1" target="_blank" rel="noopener"><em>CP936</em></a>*字码表 (Code Page 936)*的扩展（之前CP936和GB 2312-80一模一样），最早实现于<span class="exturl"><a class="exturl__link"   href="http://zh.wikipedia.org/wiki/Windows_95"  target="_blank" rel="noopener">Windows 95</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span>简体中文版。虽然GBK收录<span class="exturl"><a class="exturl__link"   href="http://zh.wikipedia.org/wiki/GB_13000"  target="_blank" rel="noopener">GB 13000.1-93</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span>的全部字符，但编码方式并不相同。GBK自身并非国家标准，只是曾由<span class="exturl"><a class="exturl__link"   href="http://zh.wikipedia.org/wiki/%E5%9B%BD%E5%AE%B6%E6%8A%80%E6%9C%AF%E7%9B%91%E7%9D%A3%E5%B1%80"  target="_blank" rel="noopener">国家技术监督局</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span>标准化司、<span class="exturl"><a class="exturl__link"   href="http://zh.wikipedia.org/wiki/%E7%94%B5%E5%AD%90%E5%B7%A5%E4%B8%9A%E9%83%A8"  target="_blank" rel="noopener">电子工业部</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span>科技与质量监督司公布为&quot;技术规范指导性文件&quot;。原始GB13000一直未被业界采用，后续国家标准<span class="exturl"><a class="exturl__link"   href="http://zh.wikipedia.org/wiki/GB18030"  target="_blank" rel="noopener">GB18030</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span>技术上兼容GBK而非GB13000。</p>
<p><strong>GB 18030</strong>，全称：<span class="exturl"><a class="exturl__link"   href="http://zh.wikipedia.org/wiki/%E4%B8%AD%E5%8D%8E%E4%BA%BA%E6%B0%91%E5%85%B1%E5%92%8C%E5%9B%BD%E5%9B%BD%E5%AE%B6%E6%A0%87%E5%87%86"  target="_blank" rel="noopener">国家标准</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span>GB 18030-2005《信息技术 中文编码字符集》，是<span class="exturl"><a class="exturl__link"   href="http://zh.wikipedia.org/wiki/%E4%B8%AD%E5%8D%8E%E4%BA%BA%E6%B0%91%E5%85%B1%E5%92%8C%E5%9B%BD"  target="_blank" rel="noopener">中华人民共和国</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span>现时最新的内码字集，是GB 18030-2000《信息技术 信息交换用汉字编码字符集 基本集的扩充》的修订版。与<span class="exturl"><a class="exturl__link"   href="http://zh.wikipedia.org/wiki/GB_2312"  target="_blank" rel="noopener">GB 2312-1980</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span>完全兼容，与<span class="exturl"><a class="exturl__link"   href="http://zh.wikipedia.org/wiki/GBK"  target="_blank" rel="noopener">GBK</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span>基本兼容，支持<span class="exturl"><a class="exturl__link"   href="http://zh.wikipedia.org/wiki/GB_13000"  target="_blank" rel="noopener">GB 13000</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span>及<span class="exturl"><a class="exturl__link"   href="http://zh.wikipedia.org/wiki/Unicode"  target="_blank" rel="noopener">Unicode</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span>的全部统一汉字，共收录汉字70244个。GB 18030主要有以下特点：</p>
<ul>
<li>与<span class="exturl"><a class="exturl__link"   href="http://zh.wikipedia.org/wiki/UTF-8"  target="_blank" rel="noopener">UTF-8</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span>相同，采用多<span class="exturl"><a class="exturl__link"   href="http://zh.wikipedia.org/wiki/%E5%AD%97%E8%8A%82"  target="_blank" rel="noopener">字节</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span>编码，每个字可以由1个、2个或4个字节组成。</li>
<li>编码空间庞大，最多可定义161万个字符。</li>
<li>支持中国国内<span class="exturl"><a class="exturl__link"   href="http://zh.wikipedia.org/wiki/%E5%B0%91%E6%95%B0%E6%B0%91%E6%97%8F"  target="_blank" rel="noopener">少数民族</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span>的文字，不需要动用造字区。</li>
<li>汉字收录范围包含繁体汉字以及日韩汉字</li>
</ul>
<p>
        <img   class="lazyload lazyload-gif"
          src="/images/loading.svg" data-src="https://gitee.com/lienhui68/picStore/raw/master/null/201105031137222069.jpg"  alt="img" />
      </p>
<p><span style='text-align: center;display:block;font-size:14px;color:颜色;background:背景颜色;'>图4 GB18030编码总体结构</span></p>
<p>本规格的初版使中华人民共和国信息产业部电子工业标准化研究所起草，由国家质量技术监督局于<span class="exturl"><a class="exturl__link"   href="http://zh.wikipedia.org/wiki/2000%E5%B9%B4"  target="_blank" rel="noopener">2000年</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span><span class="exturl"><a class="exturl__link"   href="http://zh.wikipedia.org/wiki/3%E6%9C%8817%E6%97%A5"  target="_blank" rel="noopener">3月17日</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span>发布。现行版本为国家质量监督检验总局和中国国家标准化管理委员会于<span class="exturl"><a class="exturl__link"   href="http://zh.wikipedia.org/wiki/2005%E5%B9%B4"  target="_blank" rel="noopener">2005年</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span><span class="exturl"><a class="exturl__link"   href="http://zh.wikipedia.org/wiki/11%E6%9C%888%E6%97%A5"  target="_blank" rel="noopener">11月8日</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span>发布，<span class="exturl"><a class="exturl__link"   href="http://zh.wikipedia.org/wiki/2006%E5%B9%B4"  target="_blank" rel="noopener">2006年</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span><span class="exturl"><a class="exturl__link"   href="http://zh.wikipedia.org/wiki/5%E6%9C%881%E6%97%A5"  target="_blank" rel="noopener">5月1日</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span>实施。<span style='color:LimeGreen;background:背景颜色;font-size:文字大小;font-weight:'>此规格为在中国境内所有软件产品支持的强制规格。</span></p>

        <h2 id="big5字符集编码"   >
          <a href="#big5字符集编码" class="heading-link"><i class="fas fa-link"></i></a>BIG5字符集&amp;编码</h2>
      
<p><strong>Big5</strong>，又称为<strong>大五码</strong>或<strong>五大码</strong>，是使用<span class="exturl"><a class="exturl__link"   href="http://zh.wikipedia.org/wiki/%E7%B9%81%E4%BD%93%E4%B8%AD%E6%96%87"  target="_blank" rel="noopener">繁体中文</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span>（正体中文）社区中最常用的电脑<span class="exturl"><a class="exturl__link"   href="http://zh.wikipedia.org/wiki/%E6%B1%89%E5%AD%97"  target="_blank" rel="noopener">汉字</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span><span class="exturl"><a class="exturl__link"   href="http://zh.wikipedia.org/wiki/%E5%AD%97%E7%AC%A6%E9%9B%86"  target="_blank" rel="noopener">字符集</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span>标准，共收录13,060个汉字。中文码分为<span class="exturl"><a class="exturl__link"   href="http://zh.wikipedia.org/wiki/%E5%85%A7%E7%A2%BC"  target="_blank" rel="noopener">内码</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span>及<span class="exturl"><a class="exturl__link"   href="http://zh.wikipedia.org/wiki/%E4%BA%A4%E6%8F%9B%E7%A2%BC"  target="_blank" rel="noopener">交换码</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span>两类，Big5属中文内码，知名的中文交换码有<span class="exturl"><a class="exturl__link"   href="http://zh.wikipedia.org/wiki/CCCII"  target="_blank" rel="noopener">CCCII</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span>、<span class="exturl"><a class="exturl__link"   href="http://zh.wikipedia.org/wiki/CNS11643"  target="_blank" rel="noopener">CNS11643</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span>。Big5虽普及于<span class="exturl"><a class="exturl__link"   href="http://zh.wikipedia.org/wiki/%E5%8F%B0%E7%81%A3"  target="_blank" rel="noopener">台湾</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span>、<span class="exturl"><a class="exturl__link"   href="http://zh.wikipedia.org/wiki/%E4%B8%AD%E5%9C%8B%E9%A6%99%E6%B8%AF"  target="_blank" rel="noopener">香港</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span>与<span class="exturl"><a class="exturl__link"   href="http://zh.wikipedia.org/wiki/%E4%B8%AD%E5%9C%8B%E6%BE%B3%E9%96%80"  target="_blank" rel="noopener">澳门</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span>等繁体中文通行区，但长期以来并非当地的国家标准，而只是<a href="http://zh.wikipedia.org/wiki/De_facto" target="_blank" rel="noopener"><strong>业界标准</strong></a>。<span class="exturl"><a class="exturl__link"   href="http://zh.wikipedia.org/wiki/%E5%80%9A%E5%A4%A9%E4%B8%AD%E6%96%87%E7%B3%BB%E7%B5%B1"  target="_blank" rel="noopener">倚天中文系统</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span>、<span class="exturl"><a class="exturl__link"   href="http://zh.wikipedia.org/wiki/Windows"  target="_blank" rel="noopener">Windows</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span>等主要系统的字符集都是以Big5为基准，但厂商又各自增加不同的造字与造字区，派生成多种不同版本。<span class="exturl"><a class="exturl__link"   href="http://zh.wikipedia.org/wiki/2003%E5%B9%B4"  target="_blank" rel="noopener">2003年</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span>，Big5被收录到CNS11643中文标准交换码的附录当中，取得了较正式的地位。这个最新版本被称为Big5-2003。</p>
<p>Big5码是一套<span class="exturl"><a class="exturl__link"   href="http://zh.wikipedia.org/wiki/%E5%8F%8C%E5%AD%97%E8%8A%82%E5%AD%97%E7%AC%A6%E9%9B%86"  target="_blank" rel="noopener">双字节字符集</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span>，使用了双八码存储方法，以两个字节来安放一个字。第一个字节称为&quot;高位字节&quot;，第二个字节称为&quot;低位字节&quot;。&quot;高位字节&quot;使用了0x81-0xFE，&quot;低位字节&quot;使用了0x40-0x7E，及0xA1-0xFE。在Big5的分区中：</p>
<div class="table-container"><table>
<thead>
<tr>
<th><strong>0x8140-0xA0FE</strong></th>
<th><strong>保留给用户自定义字符（<span class="exturl"><a class="exturl__link"   href="http://zh.wikipedia.org/wiki/%E9%80%A0%E5%AD%97"  target="_blank" rel="noopener">造字</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span>区）</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>0xA140-0xA3BF</strong></td>
<td><a href="http://zh.wikipedia.org/wiki/%E6%A8%99%E9%BB%9E%E7%AC%A6%E8%99%9F" target="_blank" rel="noopener"><strong>标点符号</strong></a><strong>、希腊字母及特殊符号，包括在0xA259-0xA261，安放了九个计量用汉字：兙兛兞兝兡兣嗧瓩糎。</strong></td>
</tr>
<tr>
<td><strong>0xA3C0-0xA3FE</strong></td>
<td><strong>保留。此区没有开放作造字区用。</strong></td>
</tr>
<tr>
<td><strong>0xA440-0xC67E</strong></td>
<td><a href="http://zh.wikipedia.org/wiki/%E5%B8%B8%E7%94%A8%E6%BC%A2%E5%AD%97" target="_blank" rel="noopener"><strong>常用汉字</strong></a><strong>，先按笔划再按部首排序。</strong></td>
</tr>
<tr>
<td><strong>0xC6A1-0xC8FE</strong></td>
<td><strong>保留给用户自定义字符（造字区）</strong></td>
</tr>
<tr>
<td><strong>0xC940-0xF9D5</strong></td>
<td><a href="http://zh.wikipedia.org/wiki/%E6%AC%A1%E5%B8%B8%E7%94%A8%E5%AD%97" target="_blank" rel="noopener"><strong>次常用汉字</strong></a><strong>，亦是先按笔划再按部首排序。</strong></td>
</tr>
<tr>
<td><strong>0xF9D6-0xFEFE</strong></td>
<td><strong>保留给用户自定义字符（造字区）</strong></td>
</tr>
</tbody>
</table></div>
<hr />
<p>Unicode字符集&amp;UTF编码</p>

        <h1 id="伟大的创想unicode"   >
          <a href="#伟大的创想unicode" class="heading-link"><i class="fas fa-link"></i></a>伟大的创想Unicode</h1>
      
<p><span style='text-align: center;display:block;font-size:18px;color:red;background:背景颜色;'>——不得不单独说Unicode</span></p>
<p>像天朝一样，当计算机传到世界各个国家时，为了适合当地语言和字符，设计和实现类似GB232/GBK/GB18030/BIG5的编码方案。这样各搞一套，在本地使用没有问题，一旦出现在网络中，由于不兼容，互相访问就出现了乱码现象。</p>
<p>为了解决这个问题，一个伟大的创想产生了——Unicode。Unicode编码系统为表达任意语言的任意字符而设计。它使用4字节的数字来表达每个字母、符号，或者表意文字(ideograph)。每个数字代表唯一的至少在某种语言中使用的符号。（并不是所有的数字都用上了，但是总数已经超过了65535，所以2个字节的数字是不够用的。）被几种语言共用的字符通常使用相同的数字来编码，除非存在一个在理的语源学(etymological)理由使不这样做。不考虑这种情况的话，每个字符对应一个数字，每个数字对应一个字符。即不存在二义性。不再需要记录&quot;模式&quot;了。U+0041总是代表’A’，即使这种语言没有’A’这个字符。</p>
<p>在<span class="exturl"><a class="exturl__link"   href="http://zh.wikipedia.org/wiki/%E9%9B%BB%E8%85%A6%E7%A7%91%E5%AD%B8"  target="_blank" rel="noopener">计算机科学</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span>领域中，<strong>Unicode</strong>（<strong>统一码</strong>、<strong>万国码</strong>、<strong>单一码</strong>、<strong>标准万国码</strong>）是业界的一种标准，它可以使电脑得以体现世界上数十种文字的系统。Unicode 是基于<span class="exturl"><a class="exturl__link"   href="http://zh.wikipedia.org/wiki/%E9%80%9A%E7%94%A8%E5%AD%97%E7%AC%A6%E9%9B%86"  target="_blank" rel="noopener">通用字符集</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span>（Universal Character Set）的标准来发展，并且同时也以书本的形式[<span class="exturl"><a class="exturl__link"   href="http://zh.wikipedia.org/wiki/Unicode"  target="_blank" rel="noopener">1]</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span>对外发表。Unicode 还不断在扩增， 每个新版本插入更多新的字符。直至目前为止的第六版，Unicode 就已经包含了超过十万个<span class="exturl"><a class="exturl__link"   href="http://zh.wikipedia.org/wiki/%E5%AD%97%E7%AC%A6"  target="_blank" rel="noopener">字符</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span>（在<span class="exturl"><a class="exturl__link"   href="http://zh.wikipedia.org/wiki/2005%E5%B9%B4"  target="_blank" rel="noopener">2005年</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span>，Unicode 的第十万个字符被采纳且认可成为标准之一）、一组可用以作为视觉参考的代码图表、一套编码方法与一组标准<span class="exturl"><a class="exturl__link"   href="http://zh.wikipedia.org/wiki/%E5%AD%97%E7%AC%A6%E7%BC%96%E7%A0%81"  target="_blank" rel="noopener">字符编码</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span>、一套包含了上标字、下标字等字符特性的枚举等。Unicode 组织（The Unicode Consortium）是由一个非营利性的机构所运作，并主导 Unicode 的后续发展，其目标在于：将既有的字符编码方案以Unicode 编码方案来加以取代，特别是既有的方案在多语环境下，皆仅有有限的空间以及不兼容的问题。</p>
<p>（<span style='color:red;background:背景颜色;font-size:文字大小;font-weight:bold'>可以这样理解：Unicode是字符集，UTF-32/ UTF-16/ UTF-8是三种字符编码方案。</span>）</p>

        <h2 id="ucs-unicode"   >
          <a href="#ucs-unicode" class="heading-link"><i class="fas fa-link"></i></a>UCS &amp; UNICODE</h2>
      
<p><strong>通用字符集</strong>（Universal Character Set，<strong>UCS</strong>）是由<span class="exturl"><a class="exturl__link"   href="http://zh.wikipedia.org/wiki/%E5%9C%8B%E9%9A%9B%E6%A8%99%E6%BA%96%E5%8C%96%E7%B5%84%E7%B9%94"  target="_blank" rel="noopener">ISO</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span>制定的<strong>ISO 10646</strong>（或称<strong>ISO/IEC 10646</strong>）标准所定义的标准字符集。历史上存在两个独立的尝试创立单一字符集的组织，即国际标准化组织（ISO）和多语言软件制造商组成的<span class="exturl"><a class="exturl__link"   href="http://zh.wikipedia.org/wiki/%E7%B5%B1%E4%B8%80%E7%A2%BC%E8%81%AF%E7%9B%9F"  target="_blank" rel="noopener">统一码联盟</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span>。前者开发的 ISO/IEC 10646 项目，后者开发的<span class="exturl"><a class="exturl__link"   href="http://zh.wikipedia.org/wiki/%E7%B5%B1%E4%B8%80%E7%A2%BC"  target="_blank" rel="noopener">统一码</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span>项目。因此最初制定了不同的标准。</p>
<p><span class="exturl"><a class="exturl__link"   href="http://zh.wikipedia.org/wiki/1991%E5%B9%B4"  target="_blank" rel="noopener">1991年</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span>前后，两个项目的参与者都认识到，世界不需要两个不兼容的字符集。于是，它们开始合并双方的工作成果，并为创立一个单一编码表而协同工作。从Unicode 2.0开始，Unicode采用了与ISO 10646-1相同的字库和字码；ISO也承诺，ISO 10646将不会替超出U+10FFFF的UCS-4编码赋值，以使得两者保持一致。两个项目仍都存在，并独立地公布各自的标准。但统一码联盟和ISO/IEC JTC1/SC2都同意保持两者标准的码表兼容，并紧密地共同调整任何未来的扩展。在发布的时候，Unicode一般都会采用有关字码最常见的字型，但ISO 10646一般都尽可能采用<span class="exturl"><a class="exturl__link"   href="http://zh.wikipedia.org/w/index.php?title=Century%E5%AD%97%E5%9E%8B&amp;action=edit&amp;redlink=1"  target="_blank" rel="noopener">Century字型</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span>。</p>

        <h2 id="utf-32"   >
          <a href="#utf-32" class="heading-link"><i class="fas fa-link"></i></a>UTF-32</h2>
      
<p>上述使用4字节的数字来表达每个字母、符号，或者表意文字(ideograph)，每个数字代表唯一的至少在某种语言中使用的符号的编码方案，称为UTF-32。UTF-32又称<strong>UCS-4</strong>是一种将<span class="exturl"><a class="exturl__link"   href="http://zh.wikipedia.org/wiki/Unicode"  target="_blank" rel="noopener">Unicode</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span>字符编码的协定，对每个字符都使用4字节。就空间而言，是非常没有效率的。</p>
<p>这种方法有其优点，最重要的一点就是可以在常数时间内定位字符串里的第N个字符，因为第N个字符从第4×Nth个字节开始。虽然每一个码位使用固定长定的字节看似方便，它并不如其它Unicode编码使用得广泛。</p>

        <h2 id="utf-16"   >
          <a href="#utf-16" class="heading-link"><i class="fas fa-link"></i></a>UTF-16</h2>
      
<ul>
<li>
<p>尽管有Unicode字符非常多，但是实际上大多数人不会用到超过前65535个以外的字符。因此，就有了另外一种Unicode编码方式，叫做UTF-16(因为16位 = 2字节)。UTF-16将0–65535范围内的字符编码成2个字节，如果真的需要表达那些很少使用的&quot;星芒层(astral plane)&quot;内超过这65535范围的Unicode字符，则需要<span style='color:red;background:背景颜色;font-size:文字大小;font-weight:'>使用一些诡异的技巧来实现</span>。UTF-16编码最明显的优点是它在空间效率上比UTF-32高两倍，因为每个字符只需要2个字节来存储（除去65535范围以外的），而不是UTF-32中的4个字节。并且，如果我们假设某个字符串不包含任何星芒层中的字符，那么我们依然可以在常数时间内找到其中的第N个字符，直到它不成立为止这总是一个不错的推断。其编码方法是：</p>
</li>
<li>
<p>如果字符编码U小于0x10000，也就是十进制的0到65535之内，则直接使用两字节表示；</p>
</li>
<li>
<p>如果字符编码U大于0x10000，由于UNICODE编码范围最大为0x10FFFF，从0x10000到0x10FFFF之间 共有0xFFFFF个编码，也就是需要20个bit就可以标示这些编码。用U’表示从0-0xFFFFF之间的值，将其前 10 bit作为高位和16 bit的数值0xD800进行 逻辑or 操作，将后10 bit作为低位和0xDC00做 逻辑or 操作，这样组成的 4个byte就构成了U的编码。</p>
<p>对于UTF-32和UTF-16编码方式还有一些其他不明显的缺点。不同的计算机系统会以不同的顺序保存字节。这意味着字符U+4E2D在UTF-16编码方式下可能被保存为4E 2D或者2D 4E，这取决于该系统使用的是大尾端(big-endian)还是小尾端(little-endian)。（对于UTF-32编码方式，则有更多种可能的字节排列。）只要文档没有离开你的计算机，它还是安全的——同一台电脑上的不同程序使用相同的字节顺序(byte order)。但是当我们需要在系统之间传输这个文档的时候，也许在万维网中，我们就需要一种方法来指示当前我们的字节是怎样存储的。不然的话，接收文档的计算机就无法知道这两个字节4E 2D表达的到底是U+4E2D还是U+2D4E。</p>
<p>为了解决这个问题，多字节的Unicode编码方式定义了一个&quot;字节顺序标记(Byte Order Mark)&quot;，它是一个特殊的非打印字符，你可以把它包含在文档的开头来指示你所使用的字节顺序。对于UTF-16，字节顺序标记是U+FEFF。如果收到一个以字节FF FE开头的UTF-16编码的文档，你就能确定它的字节顺序是单向的(one way)的了；如果它以FE FF开头，则可以确定字节顺序反向了。</p>
</li>
</ul>

        <h2 id="utf-8"   >
          <a href="#utf-8" class="heading-link"><i class="fas fa-link"></i></a>UTF-8</h2>
      
<ul>
<li>
<p><strong>UTF-8</strong>（8-bit Unicode Transformation Format）是一种针对<span class="exturl"><a class="exturl__link"   href="http://zh.wikipedia.org/wiki/Unicode"  target="_blank" rel="noopener">Unicode</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span>的可变长度<span class="exturl"><a class="exturl__link"   href="http://zh.wikipedia.org/wiki/%E5%AD%97%E7%AC%A6%E7%BC%96%E7%A0%81"  target="_blank" rel="noopener">字符编码</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span>（<span class="exturl"><a class="exturl__link"   href="http://zh.wikipedia.org/w/index.php?title=%E5%AE%9A%E9%95%BF%E7%A0%81&amp;action=edit&amp;redlink=1"  target="_blank" rel="noopener">定长码</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span>），也是一种<span class="exturl"><a class="exturl__link"   href="http://zh.wikipedia.org/w/index.php?title=%E5%89%8D%E7%BC%80%E7%A0%81&amp;action=edit&amp;redlink=1"  target="_blank" rel="noopener">前缀码</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span>。它可以用来表示Unicode标准中的任何字符，且其编码中的第一个<span class="exturl"><a class="exturl__link"   href="http://zh.wikipedia.org/wiki/%E5%AD%97%E8%8A%82"  target="_blank" rel="noopener">字节</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span>仍与<span class="exturl"><a class="exturl__link"   href="http://zh.wikipedia.org/wiki/ASCII"  target="_blank" rel="noopener">ASCII</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span>兼容，这使得原来处理ASCII字符的<span class="exturl"><a class="exturl__link"   href="http://zh.wikipedia.org/wiki/%E8%BB%9F%E9%AB%94"  target="_blank" rel="noopener">软件</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span>无须或只须做少部份修改，即可继续使用。因此，它逐渐成为<span class="exturl"><a class="exturl__link"   href="http://zh.wikipedia.org/wiki/%E9%9B%BB%E5%AD%90%E9%83%B5%E4%BB%B6"  target="_blank" rel="noopener">电子邮件</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span>、<span class="exturl"><a class="exturl__link"   href="http://zh.wikipedia.org/wiki/%E7%B6%B2%E9%A0%81"  target="_blank" rel="noopener">网页</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span>及其他<span class="exturl"><a class="exturl__link"   href="http://zh.wikipedia.org/wiki/%E5%84%B2%E5%AD%98%E8%A3%9D%E7%BD%AE"  target="_blank" rel="noopener">存储</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span>或传送文字的应用中，优先采用的编码。<span class="exturl"><a class="exturl__link"   href="http://zh.wikipedia.org/wiki/%E7%B6%B2%E9%9A%9B%E7%B6%B2%E8%B7%AF%E5%B7%A5%E7%A8%8B%E5%B7%A5%E4%BD%9C%E5%B0%8F%E7%B5%84"  target="_blank" rel="noopener">互联网工程工作小组</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span>（IETF）要求所有<span class="exturl"><a class="exturl__link"   href="http://zh.wikipedia.org/wiki/%E7%B6%B2%E9%9A%9B%E7%B6%B2%E8%B7%AF"  target="_blank" rel="noopener">互联网</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span><span class="exturl"><a class="exturl__link"   href="http://zh.wikipedia.org/wiki/%E7%BD%91%E7%BB%9C%E5%8D%8F%E8%AE%AE"  target="_blank" rel="noopener">协议</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span>都必须支持UTF-8编码。</p>
<p>UTF-8使用一至四个<span class="exturl"><a class="exturl__link"   href="http://zh.wikipedia.org/wiki/%E5%AD%97%E8%8A%82"  target="_blank" rel="noopener">字节</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span>为每个字符编码：</p>
</li>
</ul>
<ol>
<li>
<p>128个US-ASCII字符只需一个字节编码（Unicode范围由U+0000至U+007F）。</p>
</li>
<li>
<p>带有<span class="exturl"><a class="exturl__link"   href="http://zh.wikipedia.org/wiki/%E9%99%84%E5%8A%A0%E7%AC%A6%E5%8F%B7"  target="_blank" rel="noopener">附加符号</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span>的<span class="exturl"><a class="exturl__link"   href="http://zh.wikipedia.org/wiki/%E6%8B%89%E4%B8%81%E6%96%87"  target="_blank" rel="noopener">拉丁文</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span>、<span class="exturl"><a class="exturl__link"   href="http://zh.wikipedia.org/wiki/%E5%B8%8C%E8%87%98%E6%96%87"  target="_blank" rel="noopener">希腊文</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span>、<span class="exturl"><a class="exturl__link"   href="http://zh.wikipedia.org/wiki/%E8%A5%BF%E9%87%8C%E7%88%BE%E5%AD%97%E6%AF%8D"  target="_blank" rel="noopener">西里尔字母</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span>、<span class="exturl"><a class="exturl__link"   href="http://zh.wikipedia.org/wiki/%E4%BA%9E%E7%BE%8E%E5%B0%BC%E4%BA%9E%E8%AA%9E"  target="_blank" rel="noopener">亚美尼亚语</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span>、<span class="exturl"><a class="exturl__link"   href="http://zh.wikipedia.org/wiki/%E5%B8%8C%E4%BC%AF%E4%BE%86%E6%96%87"  target="_blank" rel="noopener">希伯来文</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span>、<span class="exturl"><a class="exturl__link"   href="http://zh.wikipedia.org/wiki/%E9%98%BF%E6%8B%89%E4%BC%AF%E6%96%87"  target="_blank" rel="noopener">阿拉伯文</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span>、<span class="exturl"><a class="exturl__link"   href="http://zh.wikipedia.org/wiki/%E5%8F%99%E5%88%A9%E4%BA%9A%E6%96%87"  target="_blank" rel="noopener">叙利亚文</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span>及<span class="exturl"><a class="exturl__link"   href="http://zh.wikipedia.org/wiki/%E5%AE%83%E6%8B%BF%E5%AD%97%E6%AF%8D"  target="_blank" rel="noopener">它拿字母</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span>则需要二个字节编码（Unicode范围由U+0080至U+07FF）。</p>
</li>
<li>
<p>其他<span class="exturl"><a class="exturl__link"   href="http://zh.wikipedia.org/wiki/%E5%9F%BA%E6%9C%AC%E5%A4%9A%E6%96%87%E7%A8%AE%E5%B9%B3%E9%9D%A2"  target="_blank" rel="noopener">基本多文种平面</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span>（BMP）中的字符（这包含了大部分常用字）使用三个字节编码。</p>
</li>
<li>
<p>其他极少使用的Unicode<span class="exturl"><a class="exturl__link"   href="http://zh.wikipedia.org/wiki/%E8%BC%94%E5%8A%A9%E5%B9%B3%E9%9D%A2"  target="_blank" rel="noopener">辅助平面</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span>的字符使用四字节编码。</p>
<p>在处理经常会用到的ASCII字符方面非常有效。在处理扩展的拉丁字符集方面也不比UTF-16差。对于中文字符来说，比UTF-32要好。同时，（在这一条上你得相信我，因为我不打算给你展示它的数学原理。）<span style='color:LimeGreen;background:背景颜色;font-size:文字大小;font-weight:'>由位操作的天性使然，使用UTF-8不再存在字节顺序的问题了。一份以utf-8编码的文档在不同的计算机之间是一样的比特流。</span></p>
</li>
</ol>
<p>总体来说，在Unicode字符串中不可能由码点数量决定显示它所需要的长度，或者显示字符串之后在文本缓冲区中光标应该放置的位置；组合字符、变宽字体、不可打印字符和从右至左的文字都是其归因。所以尽管在UTF-8字符串中字符数量与码点数量的关系比UTF-32更为复杂，在实际中很少会遇到有不同的情形。</p>
<p><strong>优点</strong></p>
<ul>
<li>UTF-8是ASCII的一个<span class="exturl"><a class="exturl__link"   href="http://zh.wikipedia.org/wiki/%E8%B6%85%E9%9B%86"  target="_blank" rel="noopener">超集</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span>。因为一个纯ASCII字符串也是一个合法的UTF-8字符串，所以现存的ASCII文本不需要转换。为传统的扩展ASCII字符集设计的软件通常可以不经修改或很少修改就能与UTF-8一起使用。</li>
<li>使用标准的面向字节的排序例程对UTF-8排序将产生与基于Unicode代码点排序相同的结果。（尽管这只有有限的有用性，因为在任何特定语言或文化下都不太可能有仍可接受的文字排列顺序。）</li>
<li>UTF-8和UTF-16都是<span class="exturl"><a class="exturl__link"   href="http://zh.wikipedia.org/wiki/%E5%8F%AF%E6%89%A9%E5%B1%95%E6%A0%87%E8%AE%B0%E8%AF%AD%E8%A8%80"  target="_blank" rel="noopener">可扩展标记语言</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span>文档的标准编码。所有其它编码都必须通过显式或文本声明来指定。</li>
<li>任何<span class="exturl"><a class="exturl__link"   href="http://zh.wikipedia.org/w/index.php?title=%E9%9D%A2%E5%90%91%E5%AD%97%E8%8A%82&amp;action=edit&amp;redlink=1"  target="_blank" rel="noopener">面向字节</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span>的<span class="exturl"><a class="exturl__link"   href="http://zh.wikipedia.org/wiki/%E5%AD%97%E7%AC%A6%E4%B8%B2%E6%90%9C%E7%B4%A2%E7%AE%97%E6%B3%95"  target="_blank" rel="noopener">字符串搜索算法</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span>都可以用于UTF-8的数据（只要输入仅由完整的UTF-8字符组成）。但是，对于包含字符记数的正则表达式或其它结构必须小心。</li>
<li>UTF-8字符串可以由一个简单的算法可靠地识别出来。就是，一个字符串在任何其它编码中表现为合法的UTF-8的可能性很低，并随字符串长度增长而减小。举例说，字符值C0,C1,F5至FF从来没有出现。为了更好的可靠性，可以使用正则表达式来统计非法过长和替代值（可以查看<span class="exturl"><a class="exturl__link"   href="http://www.w3.org/International/questions/qa-forms-utf-8"  target="_blank" rel="noopener">W3 FAQ: Multilingual Forms</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span>上的验证UTF-8字符串的正则表达式）。</li>
</ul>
<p><strong>缺点</strong></p>
<p>因为每个字符使用不同数量的字节编码，所以寻找串中第N个字符是一个O(N)复杂度的操作 — 即，<span style='color:red;background:背景颜色;font-size:文字大小;font-weight:'>串越长，则需要更多的时间来定位特定的字符。同时，还需要位变换来把字符编码成字节，把字节解码成字符。</span></p>

        <h3 id="utf-8编码的实现方法"   >
          <a href="#utf-8编码的实现方法" class="heading-link"><i class="fas fa-link"></i></a>UTF-8编码的实现方法</h3>
      
<p>为了更好的理解后面的实际应用，我们这里简单的介绍下UTF-8的编码实现方法。即UTF-8的物理存储和Unicode序号的转换关系。 UTF-8编码为变长编码。最小编码单位（<code>code unit</code>）为一个字节。一个字节的前1-3个bit为描述性部分，后面为实际序号部分。</p>
<p>UTF-8的编码规则很简单，只有二条：</p>
<ol>
<li>对于单字节的符号，字节的第一位设为0，后面7位为这个符号的unicode码。因此对于英语字母，UTF-8编码和ASCII码是相同的。</li>
<li>对于n字节的符号（n&gt;1），第一个字节的前n位都设为1，第n+1位设为0，后面字节的前两位一律设为10。剩下的没有提及的二进制位，全部为这个符号的unicode码。</li>
</ol>
<p>下表总结了编码规则，字母x表示可用编码的位。</p>
<blockquote>
<figure class="highlight plain"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">Unicode符号范围 | UTF-8编码方式</span><br><span class="line">(十六进制) | （二进制）</span><br><span class="line">--------------------+---------------------------------------------</span><br><span class="line">0000 0000-0000 007F | 0xxxxxxx</span><br><span class="line">0000 0080-0000 07FF | 110xxxxx 10xxxxxx</span><br><span class="line">0000 0800-0000 FFFF | 1110xxxx 10xxxxxx 10xxxxxx</span><br><span class="line">0001 0000-0010 FFFF | 11110xxx 10xxxxxx 10xxxxxx 10xxxxxx</span><br></pre></td></tr></table></div></figure>
</blockquote>
<p>具体每个字节的特征可见下表，其中<code>x</code>代表序号部分，把各个字节中的所有<code>x</code>部分拼接在一起就组成了在Unicode字库中的序号</p>
<div class="table-container"><table>
<thead>
<tr>
<th style="text-align:left">Byte 1</th>
<th style="text-align:left">Byte 2</th>
<th style="text-align:left">Byte3</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">0xxx xxxx</td>
<td style="text-align:left"></td>
<td style="text-align:left"></td>
</tr>
<tr>
<td style="text-align:left">110x xxxx</td>
<td style="text-align:left">10xx xxxx</td>
<td style="text-align:left"></td>
</tr>
<tr>
<td style="text-align:left">1110 xxxx</td>
<td style="text-align:left">10xx xxxx</td>
<td style="text-align:left">10xx xxxx</td>
</tr>
</tbody>
</table></div>
<p>我们分别看三个从一个字节到三个字节的UTF-8编码例子：</p>
<div class="table-container"><table>
<thead>
<tr>
<th>实际字符</th>
<th>在Unicode字库序号的十六进制</th>
<th>在Unicode字库序号的二进制</th>
<th>UTF-8编码后的二进制</th>
<th>UTF-8编码后的十六进制</th>
</tr>
</thead>
<tbody>
<tr>
<td>$</td>
<td>0024</td>
<td>010 0100</td>
<td>0010 0100</td>
<td>24</td>
</tr>
<tr>
<td>¢</td>
<td>00A2</td>
<td>000 1010 0010</td>
<td>1100 0010 1010 0010</td>
<td>C2 A2</td>
</tr>
<tr>
<td>€</td>
<td>20AC</td>
<td>0010 0000 1010 1100</td>
<td>1110 0010 1000 0010 1010 1100</td>
<td>E2 82 AC</td>
</tr>
</tbody>
</table></div>
<p>细心的读者不难从以上的简单介绍中得出以下规律：</p>
<ul>
<li>3个字节的UTF-8十六进制编码一定是以<code>E</code>开头的</li>
<li>2个字节的UTF-8十六进制编码一定是以<code>C</code>或<code>D</code>开头的</li>
<li>1个字节的UTF-8十六进制编码一定是以比<code>8</code>小的数字开头的</li>
</ul>

        <h1 id="http中的字符集和字符编码"   >
          <a href="#http中的字符集和字符编码" class="heading-link"><i class="fas fa-link"></i></a>Http中的字符集和字符编码</h1>
      
<p>Accept-Charset/Accept-Encoding/Accept-Language/Content-Type/Content-Encoding/Content-Language</p>
<p>在HTTP中，与字符集和字符编码相关的消息头是Accept-Charset/Content-Type，另外主区区分Accept-Charset/Accept-Encoding/Accept-Language/Content-Type/Content-Encoding/Content-Language：</p>
<ul>
<li>
<p>Accept-Charset</p>
<p>浏览器申明自己接收的字符集，这就是本文前面介绍的各种字符集和字符编码，如gb2312，utf-8（通常我们说Charset包括了相应的字符编码方案）；</p>
</li>
<li>
<p>Accept-Encoding</p>
<p>浏览器申明自己接收的编码方法，通常指定压缩方法，是否支持压缩，支持什么压缩方法（gzip，deflate），（注意：这不是只字符编码）；</p>
</li>
<li>
<p>Accept-Language</p>
<p>浏览器申明自己接收的语言。语言跟字符集的区别：中文是语言，中文有多种字符集，比如big5，gb2312，gbk等等；</p>
</li>
<li>
<p>Content-Type</p>
<p>WEB服务器告诉浏览器自己响应的对象的类型和字符集。例如：Content-Type: text/html; charset=‘gb2312’</p>
</li>
<li>
<p>Content-Encoding</p>
<p>WEB服务器表明自己使用了什么压缩方法（gzip，deflate）压缩响应中的对象。例如：Content-Encoding：gzip</p>
</li>
<li>
<p>Content-Language</p>
<p>WEB服务器告诉浏览器自己响应的对象的语言。</p>
</li>
</ul>

        <h1 id="乱码"   >
          <a href="#乱码" class="heading-link"><i class="fas fa-link"></i></a>乱码</h1>
      

        <h2 id="为什么会出现乱码"   >
          <a href="#为什么会出现乱码" class="heading-link"><i class="fas fa-link"></i></a>为什么会出现乱码</h2>
      
<p><strong>乱码</strong>也就是英文常说的<code>mojibake</code>（由日语的<code>文字化け</code>音译）。 简单的说乱码的出现是因为：编码和解码时用了不同或者不兼容的字符集。对应到真实生活中，就好比是一个英国人为了表示祝福在纸上写了<code>bless</code>（编码过程）。而一个法国人拿到了这张纸，由于在法语中bless表示受伤的意思，所以认为他想表达的是<code>受伤</code>（解码过程）。这个就是一个现实生活中的乱码情况。在计算机科学中一样，一个用UTF-8编码后的字符，用GBK去解码。由于两个字符集的字库表不一样，同一个汉字在两个字符表的位置也不同，最终就会出现乱码。 我们来看一个例子：假设我们用UTF-8编码存储<code>很屌</code>两个字，会有如下转换：</p>
<div class="table-container"><table>
<thead>
<tr>
<th style="text-align:left">字符</th>
<th style="text-align:left">UTF-8编码后的十六进制</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">很</td>
<td style="text-align:left">E5BE88</td>
</tr>
<tr>
<td style="text-align:left">屌</td>
<td style="text-align:left">E5B18C</td>
</tr>
</tbody>
</table></div>
<p>于是我们得到了<code>E5BE88E5B18C</code>这么一串数值。而显示时我们用GBK解码进行展示，通过查表我们获得以下信息：</p>
<div class="table-container"><table>
<thead>
<tr>
<th style="text-align:left">两个字节的十六进制数值</th>
<th style="text-align:left">GBK解码后对应的字符</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">E5BE</td>
<td style="text-align:left">寰</td>
</tr>
<tr>
<td style="text-align:left">88E5</td>
<td style="text-align:left">堝</td>
</tr>
<tr>
<td style="text-align:left">B18C</td>
<td style="text-align:left">睂</td>
</tr>
</tbody>
</table></div>
<p>解码后我们就得到了<code>寰堝睂</code>这么一个错误的结果，更要命的是连字符个数都变了。</p>

        <h2 id="如何识别乱码的本来想要表达的文字"   >
          <a href="#如何识别乱码的本来想要表达的文字" class="heading-link"><i class="fas fa-link"></i></a>如何识别乱码的本来想要表达的文字</h2>
      
<p>要从乱码字符中反解出原来的正确文字需要对各个字符集编码规则有较为深刻的掌握。但是原理很简单，这里用最常见的UTF-8被错误用GBK展示时的乱码为例，来说明具体反解和识别过程。</p>

        <h3 id="第1步-编码"   >
          <a href="#第1步-编码" class="heading-link"><i class="fas fa-link"></i></a>第1步 编码</h3>
      
<p>假设我们在页面上看到<code>寰堝睂</code>这样的乱码，而又得知我们的浏览器当前使用GBK编码。那么第一步我们就能先通过GBK把乱码编码成二进制表达式。当然查表编码效率很低，我们也可以用以下SQL语句直接通过MySQL客户端来做编码工作：</p>
<figure class="highlight plain"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">mysql [localhost] &#123;msandbox&#125; &gt; select hex(convert(&#39;寰堝睂&#39; using gbk));</span><br><span class="line">+-------------------------------------+</span><br><span class="line">| hex(convert(&#39;寰堝睂&#39; using gbk))    |</span><br><span class="line">+-------------------------------------+</span><br><span class="line">| E5BE88E5B18C                        |</span><br><span class="line">+-------------------------------------+</span><br><span class="line">1 row in set (0.01 sec)</span><br></pre></td></tr></table></div></figure>

        <h3 id="第2步-识别"   >
          <a href="#第2步-识别" class="heading-link"><i class="fas fa-link"></i></a>第2步 识别</h3>
      
<p>现在我们得到了解码后的二进制字符串<code>E5BE88E5B18C</code>。然后我们将它按字节拆开。</p>
<div class="table-container"><table>
<thead>
<tr>
<th style="text-align:left">Byte 1</th>
<th style="text-align:left">Byte 2</th>
<th style="text-align:left">Byte 3</th>
<th style="text-align:left">Byte 4</th>
<th style="text-align:left">Byte 5</th>
<th style="text-align:left">Byte 6</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">E5</td>
<td style="text-align:left">BE</td>
<td style="text-align:left">88</td>
<td style="text-align:left">E5</td>
<td style="text-align:left">B1</td>
<td style="text-align:left">8C</td>
</tr>
</tbody>
</table></div>
<p>然后套用之前UTF-8编码介绍章节中总结出的规律，就不难发现这6个字节的数据符合UTF-8编码规则。如果整个数据流都符合这个规则的话，我们就能大胆假设乱码之前的编码字符集是UTF-8</p>

        <h3 id="第3步-解码"   >
          <a href="#第3步-解码" class="heading-link"><i class="fas fa-link"></i></a>第3步 解码</h3>
      
<p>然后我们就能拿着<code>E5BE88E5B18C</code>用UTF-8解码，查看乱码前的文字了。当然我们可以不查表直接通过SQL获得结果：</p>
<figure class="highlight plain"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">mysql [localhost] &#123;msandbox&#125; ((none)) &gt; select convert(0xE5BE88E5B18C using utf8);</span><br><span class="line">+------------------------------------+</span><br><span class="line">| convert(0xE5BE88E5B18C using utf8) |</span><br><span class="line">+------------------------------------+</span><br><span class="line">| 很屌                               |</span><br><span class="line">+------------------------------------+</span><br><span class="line">1 row in set (0.00 sec)</span><br></pre></td></tr></table></div></figure>

        <h2 id="常见问题处理之emoji"   >
          <a href="#常见问题处理之emoji" class="heading-link"><i class="fas fa-link"></i></a>常见问题处理之Emoji</h2>
      
<p>所谓Emoji就是一种在Unicode位于<code>\u1F601</code>-<code>\u1F64F</code>区段的字符。这个显然超过了目前常用的UTF-8字符集的编码范围<code>\u0000</code>-<code>\uFFFF</code>。Emoji表情随着IOS的普及和微信的支持越来越常见。下面就是几个常见的Emoji:</p>
<p>
        <img   class="lazyload lazyload-gif"
          src="/images/loading.svg" data-src="https://gitee.com/lienhui68/picStore/raw/master/null/emoji_ios-20200928195924222-20200928195932383.png"  alt="emoji1" />
      
        <img   class="lazyload lazyload-gif"
          src="/images/loading.svg" data-src="https://gitee.com/lienhui68/picStore/raw/master/null/emoji_ios2-20200928195932782-20200928200001353.png"  alt="emoji2" />
      
        <img   class="lazyload lazyload-gif"
          src="/images/loading.svg" data-src="https://gitee.com/lienhui68/picStore/raw/master/null/emoji_ios3-20200928200001603.png"  alt="emoji3" />
      </p>
<p>那么Emoji字符表情会对我们平时的开发运维带来什么影响呢？最常见的问题就在于将他存入MySQL数据库的时候。一般来说MySQL数据库的默认字符集都会配置成UTF-8（三字节），而utf8mb4在5.5以后才被支持，也很少会有DBA主动将系统默认字符集改成utf8mb4。那么问题就来了，当我们把一个需要4字节UTF-8编码才能表示的字符存入数据库的时候就会报错：<code>ERROR 1366: Incorrect string value: '\xF0\x9D\x8C\x86' for column</code> 。 如果认真阅读了上面的解释，那么这个报错也就不难看懂了。我们试图将一串Bytes插入到一列中，而这串Bytes的第一个字节是<code>\xF0</code>意味着这是一个四字节的UTF-8编码。但是当MySQL表和列字符集配置为UTF-8的时候是无法存储这样的字符的，所以报了错。 那么遇到这种情况我们如何解决呢？有两种方式：升级MySQL到5.6或更高版本，并且将表字符集切换至utf8mb4。第二种方法就是在把内容存入到数据库之前做一次过滤，将Emoji字符替换成一段特殊的文字编码，然后再存入数据库中。之后从数据库获取或者前端展示时再将这段特殊文字编码转换成Emoji显示。第二种方法我们假设用<code>-*-1F601-*-</code>来替代4字节的Emoji，那么具体实现python代码可以参见<span class="exturl"><a class="exturl__link"   href="http://stackoverflow.com/questions/3220031/how-to-filter-or-replace-unicode-characters-that-would-take-more-than-3-bytes"  target="_blank" rel="noopener">Stackoverflow上的回答</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></p>

        <h2 id="乱码识别及恢复工具"   >
          <a href="#乱码识别及恢复工具" class="heading-link"><i class="fas fa-link"></i></a>乱码识别及恢复工具</h2>
      
<blockquote>
<p>说明：并非所有乱码都可以被完美恢复，乱码中的问号说明该字符已经丢失，是无法恢复的。</p>
</blockquote>
<p><span class="exturl"><a class="exturl__link"   href="http://www.mytju.com/classcode/tools/messyCodeRecover.asp"  target="_blank" rel="noopener">在线工具</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></p>
<blockquote>
<p>上面这个工具采用穷举法，类似下面这种写法</p>
<figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.eh.eden;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.apache.commons.lang3.StringUtils;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.nio.charset.Charset;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * todo</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> David Li</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@create</span> 2020/09/28</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Demo</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        testMojibake(<span class="string">"锘挎槬鐪犱笉瑙夋檽锛屽\uE629澶勯椈鍟奸笩"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">testMojibake</span><span class="params">(String source)</span> </span>&#123;</span><br><span class="line">        Charset gbkCharset = Charset.forName(<span class="string">"gbk"</span>);</span><br><span class="line">        Charset utf8Charset = Charset.forName(<span class="string">"utf-8"</span>);</span><br><span class="line">        Charset iso88591Charset = Charset.forName(<span class="string">"iso-8859-1"</span>);</span><br><span class="line"></span><br><span class="line">        Charset defaultCharset = Charset.defaultCharset();</span><br><span class="line"></span><br><span class="line">        System.out.printf(<span class="string">"defaultCharset:%s%n"</span>, defaultCharset);</span><br><span class="line"></span><br><span class="line">        System.out.println(StringUtils.repeat(<span class="string">"="</span>, <span class="number">20</span>));</span><br><span class="line"></span><br><span class="line">        String str1 = StringUtils.toEncodedString(source.getBytes(gbkCharset), utf8Charset);</span><br><span class="line">        System.out.printf(<span class="string">"gbk=&gt;utf-8：%s%n"</span>, str1);</span><br><span class="line"></span><br><span class="line">        String str4 = StringUtils.toEncodedString(source.getBytes(utf8Charset), gbkCharset);</span><br><span class="line">        System.out.printf(<span class="string">"utf-8=&gt;gbk：%s%n"</span>, str4);</span><br><span class="line"></span><br><span class="line">        String str2 = StringUtils.toEncodedString(source.getBytes(iso88591Charset), utf8Charset);</span><br><span class="line">        System.out.printf(<span class="string">"iso8859-1=&gt;utf-8：%s%n"</span>, str2);</span><br><span class="line"></span><br><span class="line">        String str5 = StringUtils.toEncodedString(source.getBytes(utf8Charset), iso88591Charset);</span><br><span class="line">        System.out.printf(<span class="string">"utf-8=&gt;iso8859-1：%s%n"</span>, str5);</span><br><span class="line"></span><br><span class="line">        String str3 = StringUtils.toEncodedString(source.getBytes(gbkCharset), iso88591Charset);</span><br><span class="line">        System.out.printf(<span class="string">"gbk=&gt;iso8859-1：%s%n"</span>, str3);</span><br><span class="line"></span><br><span class="line">        String str6 = StringUtils.toEncodedString(source.getBytes(iso88591Charset), gbkCharset);</span><br><span class="line">        System.out.printf(<span class="string">"iso8859-1=&gt;gbk：%s%n"</span>, str6);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure>
<p>运行结果</p>
<p>
        <img   class="lazyload lazyload-gif"
          src="/images/loading.svg" data-src="https://gitee.com/lienhui68/picStore/raw/master/null/image-20200928202226010.png"  alt="image-20200928202226010" />
      </p>
<p>可知一开始的编码为utf8，使用了gbk解码导致了乱码</p>
<p>正常字符 -&gt; utf编码 -&gt; gbk解码 -&gt; 乱码</p>
<p>所以现在使用gbk编码再使用utf8解码即可恢复</p>
<p>乱码 -&gt; gbk编码 -&gt; utf8解码 -&gt; 正常字符</p>
</blockquote>

        <h1 id="参考"   >
          <a href="#参考" class="heading-link"><i class="fas fa-link"></i></a>参考</h1>
      
<p><span class="exturl"><a class="exturl__link"   href="https://www.cnblogs.com/skynet/archive/2011/05/03/2035105.html#!comments"  target="_blank" rel="noopener">字符集和字符编码（Charset &amp; Encoding）</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></p>
<p><span class="exturl"><a class="exturl__link"   href="http://cenalulu.github.io/linux/character-encoding/"  target="_blank" rel="noopener">十分钟搞清字符集和字符编码</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></p>
<p><span class="exturl"><a class="exturl__link"   href="https://www.cnblogs.com/liupp123/articles/8023861.html"  target="_blank" rel="noopener">字符编码中ASCII、Unicode和UTF-8的区别</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></p>
</div><footer class="post-footer"><div class="post-ending ending"><div class="ending__text">------ 本文结束，感谢您的阅读 ------</div></div><div class="post-copyright copyright"><div class="copyright-author"><span class="copyright-author__name">本文作者: </span><span class="copyright-author__value"><a href="http://lienhui68.gitee.io">lienhui68</a></span></div><div class="copyright-link"><span class="copyright-link__name">本文链接: </span><span class="copyright-link__value"><a href="http://lienhui68.gitee.io/2020/%E5%B7%A5%E4%BD%9C/999_%E5%85%B6%E4%BB%96/%E5%AD%97%E7%AC%A6%E9%9B%86%E5%92%8C%E5%AD%97%E7%AC%A6%E7%BC%96%E7%A0%81/">http://lienhui68.gitee.io/2020/%E5%B7%A5%E4%BD%9C/999_%E5%85%B6%E4%BB%96/%E5%AD%97%E7%AC%A6%E9%9B%86%E5%92%8C%E5%AD%97%E7%AC%A6%E7%BC%96%E7%A0%81/</a></span></div><div class="copyright-notice"><span class="copyright-notice__name">版权声明: </span><span class="copyright-notice__value">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.en" rel="external nofollow" target="_blank">BY-NC-SA</a> 许可协议。转载请注明出处！</span></div></div><div class="post-reward reward"><div class="reward-button">请我喝杯咖啡~</div><div class="reward-qrcode"><span class="reward-qrcode-alipay"><img class="reward-qrcode-alipay__img" src="/assets/6.jpeg"><div class="reward-qrcode-alipay__text">支付宝打赏</div></span><span class="reward-qrcode-wechat"><img class="reward-qrcode-wechat__img" src="/assets/5.jpeg"><div class="reward-qrcode-wechat__text">微信打赏</div></span></div></div><nav class="post-paginator paginator"><div class="paginator-next"><a class="paginator-next__link" href="/2020/%E5%B7%A5%E4%BD%9C/500_%E4%B8%AD%E9%97%B4%E4%BB%B6/%E7%BC%93%E5%AD%98/redis/redis%E4%BD%BF%E7%94%A8%E5%9C%BA%E6%99%AF/"><span class="paginator-prev__text">redis使用场景</span><span class="paginator-next__icon"><i class="fas fa-angle-right"></i></span></a></div></nav></footer></div></div><div class="comments" id="comments"><div id="valine-container"></div></div></div><div class="sidebar-wrap" id="sidebar-wrap"><aside class="sidebar" id="sidebar"><div class="sidebar-nav"><span class="sidebar-nav-toc current">文章目录</span><span class="sidebar-nav-ov">站点概览</span></div><section class="sidebar-toc"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#基础知识"><span class="toc-number">1.</span> <span class="toc-text">
          基础知识</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#常用字符集和字符编码"><span class="toc-number">2.</span> <span class="toc-text">
          常用字符集和字符编码</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#ascii字符集编码"><span class="toc-number">2.1.</span> <span class="toc-text">
          ASCII字符集&amp;编码</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#gbxxxx字符集编码"><span class="toc-number">2.2.</span> <span class="toc-text">
          GBXXXX字符集&amp;编码</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#big5字符集编码"><span class="toc-number">2.3.</span> <span class="toc-text">
          BIG5字符集&amp;编码</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#伟大的创想unicode"><span class="toc-number">3.</span> <span class="toc-text">
          伟大的创想Unicode</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#ucs-unicode"><span class="toc-number">3.1.</span> <span class="toc-text">
          UCS &amp; UNICODE</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#utf-32"><span class="toc-number">3.2.</span> <span class="toc-text">
          UTF-32</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#utf-16"><span class="toc-number">3.3.</span> <span class="toc-text">
          UTF-16</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#utf-8"><span class="toc-number">3.4.</span> <span class="toc-text">
          UTF-8</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#utf-8编码的实现方法"><span class="toc-number">3.4.1.</span> <span class="toc-text">
          UTF-8编码的实现方法</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#http中的字符集和字符编码"><span class="toc-number">4.</span> <span class="toc-text">
          Http中的字符集和字符编码</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#乱码"><span class="toc-number">5.</span> <span class="toc-text">
          乱码</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#为什么会出现乱码"><span class="toc-number">5.1.</span> <span class="toc-text">
          为什么会出现乱码</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#如何识别乱码的本来想要表达的文字"><span class="toc-number">5.2.</span> <span class="toc-text">
          如何识别乱码的本来想要表达的文字</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#第1步-编码"><span class="toc-number">5.2.1.</span> <span class="toc-text">
          第1步 编码</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#第2步-识别"><span class="toc-number">5.2.2.</span> <span class="toc-text">
          第2步 识别</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#第3步-解码"><span class="toc-number">5.2.3.</span> <span class="toc-text">
          第3步 解码</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#常见问题处理之emoji"><span class="toc-number">5.3.</span> <span class="toc-text">
          常见问题处理之Emoji</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#乱码识别及恢复工具"><span class="toc-number">5.4.</span> <span class="toc-text">
          乱码识别及恢复工具</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#参考"><span class="toc-number">6.</span> <span class="toc-text">
          参考</span></a></li></ol></section><!-- ov = overview--><section class="sidebar-ov hide"><div class="sidebar-ov-author"><div class="sidebar-ov-author__avatar"><img class="sidebar-ov-author__avatar_img" src="/assets/3.png" alt="avatar"></div><p class="sidebar-ov-author__text">人类的悲欢并不相通</p></div><div class="sidebar-ov-social"><a class="sidebar-ov-social-item" href="https://github.com/lienhui68" target="_blank" rel="noopener" data-popover="Github" data-popover-pos="up"><span class="sidebar-ov-social-item__icon"><i class="fab fa-github"></i></span></a><a class="sidebar-ov-social-item" href="https://www.facebook.com/profile.php?id=100009351871465" target="_blank" rel="noopener" data-popover="Facebook" data-popover-pos="up"><span class="sidebar-ov-social-item__icon"><i class="fab fa-facebook"></i></span></a><a class="sidebar-ov-social-item" href="https://www.zhihu.com/people/lienhui68" target="_blank" rel="noopener" data-popover="知乎" data-popover-pos="up"><span class="sidebar-ov-social-item__icon">知</span></a></div><div class="sidebar-ov-state"><a class="sidebar-ov-state-item sidebar-ov-state-item--posts" href="/archives/"><div class="sidebar-ov-state-item__count">313</div><div class="sidebar-ov-state-item__name">归档</div></a><a class="sidebar-ov-state-item sidebar-ov-state-item--categories" href="/categories/"><div class="sidebar-ov-state-item__count">47</div><div class="sidebar-ov-state-item__name">分类</div></a><a class="sidebar-ov-state-item sidebar-ov-state-item--tags" href="/tags/"><div class="sidebar-ov-state-item__count">51</div><div class="sidebar-ov-state-item__name">标签</div></a></div><div class="sidebar-ov-cc"><a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.en" target="_blank" rel="noopener" data-popover="知识共享许可协议" data-popover-pos="up"><img src="/images/cc-by-nc-sa.svg"></a></div></section><div class="sidebar-reading"><div class="sidebar-reading-info"><span class="sidebar-reading-info__text">你已阅读了 </span><span class="sidebar-reading-info__num">0</span></div><div class="sidebar-reading-line"></div></div></aside></div><div class="clearfix"></div></div></main><footer class="footer" id="footer"><div class="footer-inner"><div><span>Copyright © 2020</span><span class="footer__icon"><i class="fas fa-heart"></i></span><span>lienhui68 All Rights Reserved</span></div><div class="busuanzi"><span class="busuanzi-siteuv"><span class="busuanzi-siteuv__icon"><i class="fas fa-user"></i></span><span class="busuanzi-siteuv__info">访问人数</span><span class="busuanzi-siteuv__value" id="busuanzi_value_site_uv"></span></span><span class="busuanzi-sitepv"><span class="busuanzi-siteuv__icon"><i class="fas fa-eye"></i></span><span class="busuanzi-siteuv__info">浏览总量</span><span class="busuanzi-siteuv__value" id="busuanzi_value_site_pv"></span></span></div><div>我抓不住世间的美好，只好装作万事顺遂的样子</div></div></footer><div class="loading-bar" id="loading-bar"><div class="loading-bar__progress"></div></div><div class="back2top" id="back2top"><span class="back2top__icon"><i class="fas fa-rocket"></i></span></div></div><div class="search-mask"></div><div class="search-popup"><span class="search-close"></span><div class="search-input"><input placeholder="搜索文章（支持多关键词，请用空格分隔）"></div><div class="search-results"></div></div><script src="https://cdn.jsdelivr.net/npm/jquery@v3.4.1/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/velocity-animate@1.5.2/velocity.min.js"></script><script src="https://cdn.jsdelivr.net/npm/velocity-animate@1.5.2/velocity.ui.min.js"></script><script src="https://cdn.jsdelivr.net/npm/masonry-layout@4.2.2/dist/masonry.pkgd.min.js"></script><script src="https://cdn.jsdelivr.net/npm/lazyload@2.0.0-rc.2/lazyload.min.js"></script><script>function initSearch() {
  var isXML = true;
  var search_path = 'search.json';

  if (!search_path) {
    search_path = 'search.xml';
  } else if (/json$/i.test(search_path)) {
    isXML = false;
  }

  var path = '/' + search_path;
  $.ajax({
    url: path,
    dataType: isXML ? 'xml' : 'json',
    async: true,
    success: function (res) {
      var datas = isXML ? $('entry', res).map(function () {
        // 将 XML 转为 JSON
        return {
          title: $('title', this).text(),
          content: $('content', this).text(),
          url: $('url', this).text()
        };
      }).get() : res;
      var $input = $('.search-input input');
      var $result = $('.search-results');
      // 搜索对象（标题、内容）的权重，影响显示顺序
      var WEIGHT = { title: 100, content: 1 };
      var searchPost = function () {
        var searchText = $input.val().toLowerCase().trim();
        // 根据空白字符分隔关键字
        var keywords = searchText.split(/[\s]+/);
        // 搜索结果
        var matchPosts = [];

        // 有多个关键字时，将原文字整个保存下来
        if (keywords.length > 1) {
          keywords.push(searchText);
        }
        // 防止未输入字符时搜索
        if (searchText.length > 0) {
          datas.forEach(function (data) {
            var isMatch  = false;
            // 没有标题的文章使用预设的 i18n 变量代替
            var title = (data.title && data.title.trim()) || '[ 文章无标题 ]';
            var titleLower = title && title.toLowerCase();
            // 删除 HTML 标签 和 所有空白字符
            var content = data.content && data.content.replace(/<[^>]+>/g, '');
            var contentLower = content && content.toLowerCase();
            // 删除重复的 /
            var postURL = data.url && decodeURI(data.url).replace(/\/{2,}/g, '/');
            // 标题中匹配到的关键词
            var titleHitSlice = [];
            // 内容中匹配到的关键词
            var contentHitSlice = [];

            keywords.forEach(function (keyword) {
              /**
              * 获取匹配的关键词的索引
              * @param {String} keyword 要匹配的关键字
              * @param {String} text 原文字
              * @param {Boolean} caseSensitive 是否区分大小写
              * @param {Number} weight 匹配对象的权重。权重大的优先显示
              * @return {Array}
              */
              function getIndexByword (word, text, caseSensitive, weight) {
                if (!word || !text) {
                  return [];
                };

                var startIndex = 0; // 每次匹配的开始索引
                var index = -1;     // 匹配到的索引值
                var result = [];    // 匹配结果

                if (!caseSensitive) {
                  word = word.toLowerCase();
                  text = text.toLowerCase();
                }

                while((index = text.indexOf(word, startIndex)) !== -1) {
                  var hasMatch = false;
                  // 索引位置相同的关键词，保留长度较长的
                  titleHitSlice.forEach(function (hit) {
                    if (hit.index === index && hit.word.length < word.length) {
                      hit.word = word;
                      hasMatch = true;
                    }
                  });
                  startIndex = index + word.length;
                  !hasMatch && result.push({ index: index, word: word, weight: weight });
                }
                return result;
              }
              titleHitSlice = titleHitSlice.concat(getIndexByword(keyword, titleLower, false, WEIGHT.title));
              contentHitSlice = contentHitSlice.concat(getIndexByword(keyword, contentLower, false, WEIGHT.content));
            });

            var hitTitle = titleHitSlice.length;
            var hitContent = contentHitSlice.length;

            if (hitTitle > 0 || hitContent > 0) {
              isMatch = true;
            }
            if (isMatch) {
              ;[titleHitSlice, contentHitSlice].forEach(function (hit) {
                // 按照匹配文字的索引的递增顺序排序
                hit.sort(function (left, right) {
                  return left.index - right.index;
                });
              });
              /**
              * 给文本中匹配到的关键词添加标记，从而进行高亮显示
              * @param {String} text 原文本
              * @param {Array} hitSlice 匹配项的索引信息
              * @param {Number} start 开始索引
              * @param {Number} end 结束索引
              * @return {String}
              */
              function highlightKeyword (text, hitSlice, start, end) {
                if (!text || !hitSlice || !hitSlice.length) {
                  return;
                }

                var result = '';
                var startIndex = start;
                var endIndex = end;
                hitSlice.forEach(function (hit) {
                  if (hit.index < startIndex) {
                    return;
                  }

                  var hitWordEnd = hit.index + hit.word.length;
                  result += text.slice(startIndex, hit.index);
                  result += '<b>' + text.slice(hit.index, hitWordEnd) + '</b>';
                  startIndex = hitWordEnd;
                });
                result += text.slice(startIndex, endIndex);
                return result;
              }

              var postData = {};
              // 文章总的搜索权重
              var postWeight = titleHitSlice.length * WEIGHT.title + contentHitSlice.length * WEIGHT.content;
              // 标记匹配关键词后的标题
              var postTitle = highlightKeyword(title, titleHitSlice, 0, title.length) || title;
              // 标记匹配关键词后的内容
              var postContent;
              // 显示内容的长度
              var SHOW_WORD_LENGTH = 200;
              // 命中关键词前的字符显示长度
              var SHOW_WORD_FRONT_LENGTH = 20;
              var SHOW_WORD_END_LENGTH = SHOW_WORD_LENGTH - SHOW_WORD_FRONT_LENGTH;

              // 截取匹配的第一个字符，前后共 200 个字符来显示
              if (contentHitSlice.length > 0) {
                var firstIndex = contentHitSlice[0].index;
                var start = firstIndex > SHOW_WORD_FRONT_LENGTH ? firstIndex - SHOW_WORD_FRONT_LENGTH : 0;
                var end = firstIndex + SHOW_WORD_END_LENGTH;
                postContent = highlightKeyword(content, contentHitSlice, start, end);
              } else { // 未匹配到内容，直接截取前 200 个字符来显示
                postContent = content.slice(0, SHOW_WORD_LENGTH);
              }
              postData.title = postTitle;
              postData.content = postContent;
              postData.url = postURL;
              postData.weight = postWeight;
              matchPosts.push(postData);
            }
          });
        }

        var resultInnerHtml = '';
        if (matchPosts.length) {
          // 按权重递增的顺序排序，使权重大的优先显示
          matchPosts.sort(function (left, right) {
            return right.weight - left.weight;
          });
          resultInnerHtml += '<ul>';
          matchPosts.forEach(function (post) {
            resultInnerHtml += '<li><a class="search-results-title" href="' + post.url + '">';
            resultInnerHtml += post.title;
            resultInnerHtml += '</a><div class="search-results-content">';
            resultInnerHtml += post.content;
            resultInnerHtml += '</div></li>';
          });
          resultInnerHtml += '</ul>';
        } else {
          resultInnerHtml += '<div class="search-results-none"><i class="far fa-meh"></i></div>';
        }
        $result.html(resultInnerHtml);
      };
      $input.on('input', searchPost);
      $input.on('keyup', function (e) {
        if (e.keyCode === Stun.utils.codeToKeyCode('Enter')) {
          searchPost();
        }
      });
    }
  });
}

function closeSearch () {
  $('body').css({ overflow: 'auto' });
  $('.search-popup').css({ display: 'none' });
  $('.search-mask').css({ display: 'none' });
}

window.addEventListener('DOMContentLoaded', function () {
  Stun.utils.pjaxReloadLocalSearch = function () {
    $('.header-nav-search').on('click', function (e) {
      e.stopPropagation();
      $('body').css('overflow', 'hidden');
      $('.search-popup')
        .velocity('stop')
        .velocity('transition.expandIn', {
          duration: 300,
          complete: function () {
            $('.search-popup input').focus();
          }
        });
      $('.search-mask')
        .velocity('stop')
        .velocity('transition.fadeIn', {
          duration: 300
        });

      initSearch();
    });
    $('.search-mask, .search-close').on('click', function () {
      closeSearch();
    });
    $(document).on('keydown', function (e) {
      // Escape <=> 27
      if (e.keyCode === Stun.utils.codeToKeyCode('Escape')) {
        closeSearch();
      }
    });
  };

  Stun.utils.pjaxReloadLocalSearch();
}, false);</script><link href="https://cdn.jsdelivr.net/npm/katex@0.10.2/dist/katex.min.css" rel="stylesheet" type="text/css"><script src="https://cdn.jsdelivr.net/gh/sukkaw/busuanzi@latest/bsz.pure.mini.js" async></script><script src="https://cdn.jsdelivr.net/npm/leancloud-storage@latest/dist/av-min.js"></script><script src="https://cdn.jsdelivr.net/npm/valine@latest/dist/Valine.min.js"></script><script>function loadValine () {
  var GUEST_INFO = ['nick', 'mail', 'link'];
  var guest_info = 'nick,mail,link';

  guest_info = guest_info.split(',').filter(function(item) {
    return GUEST_INFO.indexOf(item) > -1;
  });
  new Valine({
    el: '#valine-container',
    appId: 'iTixDcNjX1XLIDnENLxM9F1E-gzGzoHsz',
    appKey: 'hKBKmiysmFkqF2ik6yCcEATU',
    notify: true,
    verify: true,
    placeholder: '欢迎评论',
    avatar: 'mp',
    meta: guest_info,
    pageSize: '10' || 10,
    visitor: false,
    recordIP: false,
    lang: '' || 'zh-cn',
    path: window.location.pathname
  });
}

if (false) {
  loadValine();
} else {
  window.addEventListener('DOMContentLoaded', loadValine, false);
}</script><script src="/js/utils.js?v=2.0.1"></script><script src="/js/stun-boot.js?v=2.0.1"></script><script src="/js/scroll.js?v=2.0.1"></script><script src="/js/header.js?v=2.0.1"></script><script src="/js/sidebar.js?v=2.0.1"></script></body></html>